#include <Arduino.h>
#include "controller.h"
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "esp_task_wdt.h"

// TaskHandle_t ControllerTask;

// void controller_setup()
// {
//     xTaskCreatePinnedToCore(
//         controller_task,          /* Task function. */
//         "Controller Task",        /* name of task. */
//         3000,                /* Stack size of task (uxTaskGetStackHighWaterMark:11708) */
//         NULL,                /* parameter of the task */
//         1, /* priority of the task */
//         &ControllerTask, 0);      /* Task handle to keep track of created task */
// }

void controller_setup()
{
   // Ps3.attach(notify);
   // Ps3.attachOnConnect(onConnect);
    Ps3.begin();
    
    //String address = Ps3.getAddress();

    //Serial.print("The ESP32's Bluetooth MAC address is: ");
    //Serial.println(address);

    //Ps3.begin("98:f4:ab:67:8e:8e");
    //Ps3.begin(address.c_str());

    //delay(100);

    
    // for (;;)
    // {
    //     delay(100);

    //     esp_task_wdt_reset();
    // }

    // vTaskDelete(NULL);
}

void onConnect()
{
    Serial.println("PS3 Connected!.");
}

void notify()
{
    if (Ps3.data.button.cross)
    {
        Serial.println("Pressing the cross button");
    }

    if (Ps3.data.button.square)
    {
        Serial.println("Pressing the square button");
    }

    if (Ps3.data.button.triangle)
    {
        Serial.println("Pressing the triangle button");
    }

    if (Ps3.data.button.circle)
    {
        Serial.println("Pressing the circle button");
    }
}
